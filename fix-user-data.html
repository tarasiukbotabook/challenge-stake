<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #17212b;
      color: #fff;
      padding: 20px;
      max-width: 600px;
      margin: 0 auto;
    }
    .section {
      background: rgba(26, 31, 38, 0.6);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
    }
    h2 {
      color: #10b981;
      margin-top: 0;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(0,0,0,0.3);
      color: white;
      font-size: 14px;
    }
    button {
      background: #10b981;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background: #059669;
    }
    .result {
      margin-top: 12px;
      padding: 12px;
      border-radius: 8px;
      background: rgba(0,0,0,0.3);
    }
    .success {
      color: #10b981;
    }
    .error {
      color: #ef4444;
    }
  </style>
</head>
<body>
  <h1>üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h1>
  
  <div class="section">
    <h2>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h2>
    <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å username, firstName –∏ photoUrl –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</p>
    <p>–û—Ç–∫—Ä–æ–π—Ç–µ Telegram Web App –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ (F12):</p>
    <pre style="background: rgba(0,0,0,0.5); padding: 12px; border-radius: 8px; overflow-x: auto;">
Telegram user data: {
  id: 123456789,
  first_name: "–í–∏—Ç–∞–ª–∏–π",
  username: "vitaly_user",
  photo_url: "https://..."
}
    </pre>
  </div>

  <div class="section">
    <h2>–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>
    <form id="update-form">
      <label>User ID (–∏–∑ –∫–æ–Ω—Å–æ–ª–∏ "Loading user stats for:"):</label>
      <input type="text" id="userId" placeholder="jn79ggj84hdhrwj018yhy4ygws7yhe42" required>
      
      <label>Username (–∏–∑ Telegram):</label>
      <input type="text" id="username" placeholder="vitaly_user">
      
      <label>First Name (–∏–∑ Telegram):</label>
      <input type="text" id="firstName" placeholder="–í–∏—Ç–∞–ª–∏–π">
      
      <label>Photo URL (–∏–∑ Telegram):</label>
      <input type="text" id="photoUrl" placeholder="https://...">
      
      <button type="submit">–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
    </form>
    <div id="result"></div>
  </div>

  <script>
    const CONVEX_URL = "https://greedy-badger-196.convex.cloud";

    const client = {
      async mutation(functionName, args) {
        const response = await fetch(`${CONVEX_URL}/api/mutation`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            path: functionName,
            args: args || {},
            format: 'json',
          }),
        });
        
        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || 'Mutation failed');
        }
        
        const data = await response.json();
        if (data.status === 'error') {
          throw new Error(data.errorMessage || 'Mutation failed');
        }
        return data.value;
      }
    };

    document.getElementById('update-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = '<div>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ...</div>';
      
      const userId = document.getElementById('userId').value.trim();
      const username = document.getElementById('username').value.trim();
      const firstName = document.getElementById('firstName').value.trim();
      const photoUrl = document.getElementById('photoUrl').value.trim();
      
      if (!userId) {
        resultDiv.innerHTML = '<div class="error">‚ùå –í–≤–µ–¥–∏—Ç–µ User ID</div>';
        return;
      }
      
      try {
        const updates = { userId };
        if (username) updates.username = username;
        if (firstName) updates.firstName = firstName;
        if (photoUrl) updates.photoUrl = photoUrl;
        
        await client.mutation("users:updateProfile", updates);
        
        resultDiv.innerHTML = `
          <div class="success">‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω!</div>
          <div style="margin-top: 12px;">
            <strong>–û–±–Ω–æ–≤–ª–µ–Ω–æ:</strong><br>
            ${username ? `Username: ${username}<br>` : ''}
            ${firstName ? `First Name: ${firstName}<br>` : ''}
            ${photoUrl ? `Photo URL: ${photoUrl}<br>` : ''}
          </div>
          <div style="margin-top: 12px; opacity: 0.7;">
            –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å
          </div>
        `;
      } catch (error) {
        resultDiv.innerHTML = `
          <div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>
          <pre style="margin-top: 8px; font-size: 12px;">${error.stack}</pre>
        `;
      }
    });
  </script>
</body>
</html>
